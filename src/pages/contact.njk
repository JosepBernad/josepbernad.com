---
pagination:
  data: languages.list
  size: 1
  alias: lang
permalink: "{{ lang.prefix }}/contact/"
layout: base.njk
pageId: contact
showClaim: false
showName: true
sectionName: Contact
eleventyComputed:
  currentLang: "{{ lang.code }}"
  currentPrefix: "{{ lang.prefix }}"
  lang: "{{ lang.code }}"
  langPrefix: "{{ lang.prefix }}"
---

<div class="section-container contact-container">
  <p class="contact-intro" data-i18n-html="contact.intro"></p>
  
  <form class="contact-form" id="contact-form">
    <input type="text" id="name" name="from_name" data-i18n-placeholder="contact.namePlaceholder" required>
    <input type="email" id="email" name="reply_to" data-i18n-placeholder="contact.emailPlaceholder" required>
    <input type="text" id="subject" name="subject" data-i18n-placeholder="contact.subjectPlaceholder" required>
    <textarea id="message" name="message" rows="6" data-i18n-placeholder="contact.messagePlaceholder" required></textarea>
    <!-- reCAPTCHA v2 Invisible -->
    <div class="g-recaptcha" 
         data-sitekey="6Lf3L0MsAAAAAHONJ9WOTAieL_vuKcUWqv9yf7rV"
         data-callback="onRecaptchaSuccess"
         data-size="invisible">
    </div>
    <button type="submit" class="form-submit" data-i18n="contact.sendButton"></button>
  </form>
  
  <p class="contact-status" id="contact-status"></p>
  
  <p class="contact-email">
    <span data-i18n-html="contact.orEmail"></span>
    <a id="contact-email-link" href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#104;&#105;&#64;&#106;&#111;&#115;&#101;&#112;&#98;&#101;&#114;&#110;&#97;&#100;&#46;&#99;&#111;&#109;" data-i18n-html="contact.emailAddress"></a>
  </p>
  
  <p class="recaptcha-branding" data-i18n-html="contact.recaptcha">
    This site is protected by reCAPTCHA and the Google
    <a href="https://policies.google.com/privacy" target="_blank" rel="noopener">Privacy Policy</a> and
    <a href="https://policies.google.com/terms" target="_blank" rel="noopener">Terms of Service</a> apply.
  </p>
</div>

<!-- reCAPTCHA v2 Invisible -->
<script src="https://www.google.com/recaptcha/api.js" async defer></script>

<!-- EmailJS SDK -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>
(function() {
  // EmailJS Configuration
  const EMAILJS_PUBLIC_KEY = '0rAuLMUuVzUegGiS7';
  const EMAILJS_SERVICE_ID = 'service_zc9v6ym';
  
  // Template IDs per language
  const TEMPLATES = {
    en: 'webform-en',
    es: 'webform-ca/es',
    ca: 'webform-ca/es'
  };
  
  // Status messages per language
  const STATUS_MESSAGES = {
    en: { 
      success: '✓ Message sent successfully!', 
      error: '✗ Failed to send. Please try again.',
      captchaError: '✗ Security verification failed. Please refresh and try again.'
    },
    es: { 
      success: '✓ Mensaje enviado correctamente.', 
      error: '✗ Error al enviar. Inténtalo de nuevo.',
      captchaError: '✗ Verificación de seguridad fallida. Actualiza la página e inténtalo de nuevo.'
    },
    ca: { 
      success: '✓ Missatge enviat correctament.', 
      error: '✗ Error en enviar. Torna-ho a provar.',
      captchaError: '✗ Verificació de seguretat fallida. Actualitza la pàgina i torna-ho a provar.'
    }
  };
  
  emailjs.init(EMAILJS_PUBLIC_KEY);
  
  const form = document.getElementById('contact-form');
  const status = document.getElementById('contact-status');
  let formBtn, originalBtnText;
  
  // Called when reCAPTCHA is successfully completed
  window.onRecaptchaSuccess = function(token) {
    const lang = document.documentElement.getAttribute('lang') || 'en';
    const templateId = TEMPLATES[lang] || TEMPLATES.en;
    const messages = STATUS_MESSAGES[lang] || STATUS_MESSAGES.en;
    
    // Send email via EmailJS
    emailjs.sendForm(EMAILJS_SERVICE_ID, templateId, form)
      .then(function() {
        status.textContent = messages.success;
        status.className = 'contact-status success';
        form.reset();
        grecaptcha.reset();
      })
      .catch(function(error) {
        status.textContent = messages.error;
        status.className = 'contact-status error';
        grecaptcha.reset();
        console.error('EmailJS error:', error);
      })
      .finally(function() {
        formBtn.disabled = false;
        formBtn.textContent = originalBtnText;
      });
  };
  
  if (form) {
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const lang = document.documentElement.getAttribute('lang') || 'en';
      const messages = STATUS_MESSAGES[lang] || STATUS_MESSAGES.en;
      
      // Store button reference for later
      formBtn = form.querySelector('.form-submit');
      originalBtnText = formBtn.textContent;
      formBtn.disabled = true;
      formBtn.textContent = '...';
      
      // Clear previous status
      status.textContent = '';
      status.className = 'contact-status';
      
      // Execute invisible reCAPTCHA
      try {
        grecaptcha.execute();
      } catch (error) {
        status.textContent = messages.captchaError;
        status.className = 'contact-status error';
        formBtn.disabled = false;
        formBtn.textContent = originalBtnText;
        console.error('reCAPTCHA error:', error);
      }
    });
  }
})();
</script>
